(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const e of s)if(e.type==="childList")for(const u of e.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(s){const e={};return s.integrity&&(e.integrity=s.integrity),s.referrerPolicy&&(e.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?e.credentials="include":s.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function r(s){if(s.ep)return;s.ep=!0;const e=n(s);fetch(s.href,e)}})();function b(t){function o(n){t.fillStyle=n.background??"black",t.fillRect(n.x,n.y,n.width??0,n.height??0)}return{drawRectangle:o}}function X(t){function o(e){t.font=`${e.fontSize}px serif`,t.fillStyle=e.color??"black",t.fillText(e.text,e.x,e.y)}function n(e){t.font=`${e.fontSize}px serif`,t.fillStyle=e.color??"black"}function r(e){t.fillText(e.text,e.x,e.y)}function s(e){return t.measureText(e)}return{drawText:o,styleText:n,fillText:r,measureText:s}}const Y=(t,o)=>{let n=null;return(...r)=>{n||(n=setTimeout(()=>{clearTimeout(n),n=null},o),t(...r))}};function I(t){function o(r=0,s=0,e=window.innerWidth,u=window.innerHeight,c=1,i){requestAnimationFrame(()=>{t.resetTransform(),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.setTransform(1*c,0,0,1*c,-r,-s),i(r,s,e,u,c)})}const n=Y(o,0);return{render:o,throttleRender:n}}function z(t){const o=t.canvas,n={mousedown:[],mouseup:[],mousemove:[],touchmove:[],touchstart:[],touchend:[],click:[],wheel:[]};for(let s in n){const e=s;o.addEventListener(e,u=>{n[e].forEach(c=>c(u))})}function r(s,e){return n[s].push(e),()=>{n[s]=n[s].filter(u=>u!==e)}}return{addEvent:r}}function k(t){if(!t)throw new Error("Нет канвас");const o=t.getContext("2d");if(!o)throw new Error("Нет 2d");function n(){t.width=window.innerWidth,t.height=window.innerHeight}n(),o.textBaseline="top";const r=()=>({width:t.width,height:t.height});return{rectangleMethods:b(o),textMethods:X(o),renderMethods:I(o),eventsMethods:z(o),getCanvasSize:r}}function A(t,o){return n=>{t.textMethods.styleText({fontSize:n.fontSize,color:n.color});const{x:r,y:s,width:e,content:u,fontSize:c}=n;if(!e||t.textMethods.measureText(u).width<=e){t.textMethods.fillText({text:u,x:r,y:s});return}let i=r,l=s,d="",h=0;const f=u.split(" ");for(let g=0;g<f.length;g++){const m=f[g],a=d?` ${m}`:m,v=t.textMethods.measureText(a).width;h+v>=e?(t.textMethods.fillText({text:d.trim(),x:i,y:l}),i=r,l+=c,d=m,h=t.textMethods.measureText(m).width):(d+=a,h+=v)}d&&t.textMethods.fillText({text:d.trim(),x:i,y:l})}}function Z(t,o){return{text:A(t)}}function L(t,o,n){return r=>{o.sectorManager.attachElement({x:r.x,y:r.y,width:r.width??0,height:r.height??0,render:()=>{t.rectangleMethods.drawRectangle(r)}})}}function _(t,o,n){function r(c,i,l,d,h,f){return{x:i,y:l,width:c.width,height:c.height,events:{click:f},render:()=>{t.rectangleMethods.drawRectangle({x:d,y:h,width:c.width,height:c.height,background:c.background??"black"}),c.text&&n.text({content:c.text,color:c.color,x:d,y:h,width:c.width,fontSize:24})}}}function s(c,i){let l=i.x??0,d=i.y??0,h=0,f=0;const g=[];for(let m=0;m<c.length;m++){const a=c[m];let v=l,w=d;i.direction==="vert"?(d+=a.marginTop??0,v=l+(a.marginLeft??0)):(l+=a.marginLeft??0,w=d+(a.marginTop??0));let x=0,p=0;if("textBlock"in a)g.push(r(a.textBlock,l,d,v,w,a.click)),x=a.textBlock.width,p=a.textBlock.height;else{const T=a.slot({x:l,y:d});x=T.width,p=T.height}i.direction==="vert"?(x>h&&(h=x),d+=p):(p>f&&(f=p),l+=x)}return o.sectorManager.attachElements(g),{width:Math.max(l-(i.x??0),h),height:Math.max(d-(i.y??0),f)}}function e(c,i){return s(c,{...i,direction:"vert"})}function u(c,i){return s(c,{...i,direction:"horyz"})}return{rows:e,columns:u}}function F(t,o,n){const r=_(t,o,n);return{absolute:L(t,o),rows:r.rows,columns:r.columns}}function D(t,o){const n=Z(t),r=F(t,o,n);return{atoms:n,molecules:r}}function P(t,o){function n(e=0,u=0,c=t.getCanvasSize().width,i=t.getCanvasSize().height,l=1){const d=Math.floor(e/o.SECTOR_SIZE/l),h=Math.floor(u/o.SECTOR_SIZE/l),f=Math.floor((e+c)/o.SECTOR_SIZE/l),g=Math.floor((u+i)/o.SECTOR_SIZE/l);for(let m=d;m<=f;m++)for(let a=h;a<=g;a++){const v=o.getSector(m,a);if(v)for(let w=0;w<v.length;w++)v[w].render()}}function r(e=0,u=0,c=t.getCanvasSize().width,i=t.getCanvasSize().height,l=1){t.renderMethods.render(e,u,c,i,l,n)}function s(e=0,u=0,c=t.getCanvasSize().width,i=t.getCanvasSize().height,l=1){t.renderMethods.render(e,u,c,i,l,n)}return{render:s,firstRender:r}}const $=t=>1-(1-t)*(1-t);function N(t,o,n,r){let s=performance.now();requestAnimationFrame(function e(u){if(r!=null&&r.aborted)return;let c=(u-s)/n;c>1&&(c=1);let i=t(c);o(i),c<1&&!(r!=null&&r.aborted)&&requestAnimationFrame(e)})}function W(t){return(...o)=>{requestAnimationFrame(()=>{t(...o)})}}const E=30,q=800;function j(t){let o=!1,n=null,r=0,s=0;function e(l,d){o=!0,t.setCamera({moveX:t.cameraAdditionalInfo.moveXOnStartMove-l+r,moveY:t.cameraAdditionalInfo.moveYOnStartMove-d+s})}function u(l,d){const h=t.getCamera();t.cameraAdditionalInfo.moveXOnStartMove=h.moveX,t.cameraAdditionalInfo.moveYOnStartMove=h.moveY,r=l,s=d,n==null||n.abort()}function c(){if(!o)return;o=!1,n=new AbortController;const l=t.getCamera(),d=l.moveX-t.getPrevCamera().moveX,h=l.moveY-t.getPrevCamera().moveY;N($,f=>{t.setCamera({moveX:l.moveX+d*E*f,moveY:l.moveY+h*E*f})},q,n.signal)}function i(){o=!1,n==null||n.abort()}return{pointerdown:u,pointerup:c,move:W(e),stopActiveMove:i}}const B=.3;function G(t){let o=0;function n(u,c,i){const[l,d]=t.getPointerCoord(u,c),h=t.getCamera(),f=h.zoomRatio,g=Math.max(i,B),m=l*(g-f),a=d*(g-f);t.cameraAdditionalInfo.moveXOnStartMove+=m,t.cameraAdditionalInfo.moveYOnStartMove+=a;const v=h.moveX+m,w=h.moveY+a;t.setCamera({moveX:v,moveY:w,zoomRatio:g})}function r(u,c,i){n(u,c,i+t.getCamera().zoomRatio)}function s(u,c,i){n(u,c,o*i)}function e(){o=t.getCamera().zoomRatio}return{modifyZoom:r,initZoom:e,zoomRelativeStartZoom:s}}function H(t,o){const{width:n,height:r}=t.getCanvasSize();let s={moveX:0,moveY:0,zoomRatio:1};const e={moveX:0,moveY:0,zoomRatio:1},u={moveXOnStartMove:0,moveYOnStartMove:0};let c=!1;function i(){c||Promise.resolve().then(()=>{o.render(e.moveX,e.moveY,n,r,e.zoomRatio),c=!1}),c=!0}const l=({moveX:h=e.moveX,moveY:f=e.moveY,zoomRatio:g=e.zoomRatio})=>{s={...e},e.moveX=h,e.moveY=f,e.zoomRatio=g,i()};function d(h,f){return[(e.moveX+h)/e.zoomRatio,(e.moveY+f)/e.zoomRatio]}return{getCamera:()=>({...e}),setCamera:l,getPrevCamera:()=>({...s}),getPointerCoord:d,getCanvasSize:()=>({width:n,height:r}),cameraAdditionalInfo:u}}const U=.1;function K(t,o,n){let r=null,s=()=>{};t.eventsMethods.addEvent("mousedown",e=>{o.pointerdown(e.x,e.y),r=setTimeout(()=>{s=t.eventsMethods.addEvent("mousemove",u=>{e.preventDefault(),o.move(u.x,u.y)})},50)}),t.eventsMethods.addEvent("mouseup",()=>{o.pointerup(),r&&clearTimeout(r),s()}),t.eventsMethods.addEvent("wheel",e=>{e.preventDefault(),o.stopActiveMove();const u=e.deltaY>0?-.1:U;n.modifyZoom(e.x,e.y,u)})}const Q=300;function V(t,o,n){let r=0;function s(i){const l=Math.abs(i.touches[0].clientX-i.touches[1].clientX),d=Math.abs(i.touches[0].clientY-i.touches[1].clientY);return Math.sqrt(l*l+d*d)}function e(i){return[(i.touches[0].clientX+i.touches[1].clientX)/2,(i.touches[0].clientY+i.touches[1].clientY)/2]}let u=!1,c=!1;t.eventsMethods.addEvent("touchmove",i=>{if(i.preventDefault(),i.touches.length===1&&o.move(i.touches[0].clientX,i.touches[0].clientY),i.touches.length===2){const l=s(i);n.zoomRelativeStartZoom(...e(i),l/r);const d=e(i);o.move(d[0],d[1])}}),t.eventsMethods.addEvent("touchstart",i=>{c=!1,i.touches.length===1&&o.pointerdown(i.touches[0].clientX,i.touches[0].clientY),i.touches.length===2&&(u=!0,n.initZoom(),r=s(i),o.pointerdown(...e(i)))}),t.eventsMethods.addEvent("touchend",i=>{i.touches.length===1&&(u&&(c=!0,setTimeout(()=>{c=!1},Q)),o.stopActiveMove(),o.pointerdown(i.touches[0].clientX,i.touches[0].clientY)),i.touches.length||(c?o.stopActiveMove():o.pointerup())})}function J(t,o){const n=H(t,o),r=j(n),s=G(n);return{cameraControl:n,moveControl:r,zoomControl:s,init:()=>{K(t,r,s),V(t,r,s)}}}function tt(t,o,n){function r(e,u,c){for(let i=0;i<e.length;i++){const l=e[i];if(u>=l.x&&c>=l.y&&u<=l.x+l.width&&c<=l.y+l.height)return l}}function s(){t.eventsMethods.addEvent("click",e=>{var i,l;const u=n.cameraControl.getPointerCoord(e.x,e.y),c=o.getSector(Math.floor(u[0]/o.SECTOR_SIZE),Math.floor(u[1]/o.SECTOR_SIZE));if(c){const d=r(c,u[0],u[1]);d&&((l=(i=d.events)==null?void 0:i.click)==null||l.call(i))}})}return{init:()=>{s()}}}function et(t,o,n){const r=J(t,n),s=tt(t,o,r);return{init:()=>{r.init(),s.init()}}}const y=1e3;function ot(){const t=[];function o(e,u){var c;return(c=t[u])==null?void 0:c[e]}function n(e,u,c){t[u]||(t[u]=[]),t[u][e]||(t[u][e]=[]),t[u][e].push(c)}function r(e){const u=Math.floor(e.x/y),c=Math.floor(e.y/y),i=Math.floor((e.x+e.width)/y),l=Math.floor((e.y+e.height)/y);for(let d=u;d<=i;d++)for(let h=c;h<=l;h++)n(d,h,e)}function s(e){e.forEach(r)}return{attachElement:r,attachElements:s,getSector:o,SECTOR_SIZE:y}}function nt(t){const o=ot(),n=P(t,o),r=et(t,o,n);return{sectorManager:o,renderManager:n,eventsManager:r}}function it(t){const o=k(t),n=nt(o),r=D(o,n);return{render:s=>{s(r),n.renderManager.firstRender(),n.eventsManager.init()}}}const M=50,rt=1600;function st(t){const o=[];for(let n=0;n<M;n++){const r=[];for(let s=0;s<M+1;s++)r.push({marginLeft:25,textBlock:{background:"purple",text:`${n}- ${s}`,width:50+Math.random()*60,height:50+Math.random()*60}});o.push({marginTop:25,slot:s=>t.molecules.columns(r,s)})}t.molecules.rows(o,{x:rt})}const ct=1e3,ut=100;async function lt(t){const r=(await(await fetch("https://jsonplaceholder.typicode.com/todos")).json()).map(s=>({marginTop:20,textBlock:{background:s.completed?"lightgreen":"orange",text:`${s.userId} - ${s.title}`,width:300,height:100}}));t.molecules.rows(r,{x:ct,y:ut})}const S=4e3,R=[];for(let t=0;t<S/2;t++)R.push({marginTop:10,marginLeft:10,textBlock:{background:`rgb(${t*20%255}, ${t*20%255}, 255)`,text:`${t*10+21} очеееееень длиннннннныыыыый теееееееееекст`,width:250,height:100},click:()=>console.log(t)});const C=[];for(let t=0;t<S;t++)C.push({marginTop:25,marginLeft:10,textBlock:{background:"yellow",text:`${t}. testestests estest testestset esteststse`,width:500,height:50+ +Math.random()*70},click:()=>console.log(t)});const O=[];for(let t=0;t<S;t++)O.push({marginTop:25,marginLeft:10,textBlock:{background:"green",text:`${t*2}. i am in row`,width:100+Math.random()*100,height:200},click:()=>console.log(t,"elems3")});it(document.getElementById("canvas")).render(t=>{t.molecules.rows(R),t.molecules.rows(C,{x:500}),t.molecules.columns(O,{y:-300}),st(t),lt(t),t.molecules.absolute({x:700,y:150,width:100,height:100,background:"green"}),t.molecules.absolute({x:-100,y:-100,width:100,height:100,background:"red"})});
